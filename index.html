<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>TON Monitoring</title>
    <meta name="description" content="Все самые интересные новости экосистемы TON. TON’t Worry, We’re Watching. Keep Calm and TON" />
    <meta name="viewport" content="width=device-width, maximum-scale=1.0, minimum-scale=1.0, initial-scale=1.0" />
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="canonical" href="https://tonmonitoring.com/" />
    <style>
      body{
        max-width: 100vw;
        min-height: 100dvh;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 10px;
      }
      header {
        width: fit-content;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      .logo {
        width: 80%;
        margin: 8px 0 0 0;
      }
      h1 {
        margin: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        font-family: Montserrat;
      }
      footer {
        width: 100%;
        margin-top: auto;
      }
      .footer-txt {
        margin: 8px 4px -8px;
      }
    </style>
  </head>
  <body>
    <header>
      <img src="/img/logo.svg" alt="TON Monitoring" class="logo">
      <h1>TON MONITORING</h1>
    </header>

    <main>
      <div id="telegram-feed">
        <!-- Посты будут загружены сюда -->
      </div>
    </main>

    <footer>
      <img src="/img/tm-name.svg" alt="TON Monitoring" class="footer-txt">
    </footer>

    <style>
.post {
  margin: 16px;
  padding: 0 12px;
  border: 1px solid #000;
  border-radius: 8px;
}
.cashtag {
    color: #0e80fa;
    cursor: pointer;
}

.custom-emoji {
    /* Стили для кастомных эмодзи. Можно задать размер. */
    display: inline-block;
    vertical-align: middle;
    /* Можно добавить фоновое изображение как временное решение */
}
    </style>
    <script>
document.addEventListener("DOMContentLoaded", function() {
    fetch('posts.json')
        .then(response => response.json())
        .then(posts => {
            const feedContainer = document.getElementById('telegram-feed');

            posts.forEach(post => {
                const postElement = document.createElement('div');
                postElement.className = 'post';

                // Проверяем, есть ли текст и сущности для форматирования
                if (post.text && post.entities) {
                    let htmlText = post.text;
                    // Копируем и сортируем сущности в обратном порядке по смещению (offset)
                    // Это нужно, чтобы при замене текста не сбивались индексы следующих сущностей
                    const entities = post.entities.slice().sort((a, b) => b.offset - a.offset);

                    entities.forEach(entity => {
                        const start = entity.offset;
                        const end = entity.offset + entity.length;
                        const originalText = htmlText.substring(start, end);
                        let replacement = originalText;

                        switch (entity.type) {
                            case 'bold':
                                replacement = `<b>${originalText}</b>`;
                                break;
                            case 'italic':
                                replacement = `<i>${originalText}</i>`;
                                break;
                            case 'text_link':
                                replacement = `<a href="${entity.url}" target="_blank" rel="noopener noreferrer">${originalText}</a>`;
                                break;
                            case 'mention':
                                // Создаем ссылку на профиль, убирая @ из начала
                                replacement = `<a href="https://t.me/${originalText.substring(1)}" target="_blank" rel="noopener noreferrer">${originalText}</a>`;
                                break;
                            case 'hashtag':
                                 // Создаем ссылку на поиск по хештегу, убирая #
                                replacement = `<a href="https://t.me/hashtag/${originalText.substring(1)}" target="_blank" rel="noopener noreferrer">${originalText}</a>`;
                                break;
                            case 'cashtag':
                                replacement = `<span class="cashtag">${originalText}</span>`;
                                break;
                            case 'custom_emoji':
                                replacement = `<span class="custom-emoji" data-id="${entity.custom_emoji_id}">${originalText}</span>`;
                                break;
                            // Можно добавить и другие типы: 'underline', 'strikethrough', 'code', 'pre'
                        }
                        
                        // Заменяем часть строки на HTML-код
                        htmlText = htmlText.slice(0, start) + replacement + htmlText.slice(end);
                    });
                    
                    const textElement = document.createElement('p');
                    textElement.innerHTML = htmlText; // Используем innerHTML для вставки HTML
                    postElement.appendChild(textElement);

                } else if (post.text) {
                    // Если сущностей нет, просто вставляем текст
                    const textElement = document.createElement('p');
                    textElement.innerText = post.text;
                    postElement.appendChild(textElement);
                }

                feedContainer.appendChild(postElement);
            });
        })
        .catch(error => console.error('Ошибка загрузки постов:', error));
});

    </script>
  </body>
</html>